# JavaScript æ¨¡å—åŒ–è§„èŒƒ

## æ¨¡å—åŒ–æ¦‚è¿°

### ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–ï¼Ÿ

- å°†ç¨‹åºæ–‡ä»¶ä¾æ®ä¸€å®šè§„åˆ™`æ‹†åˆ†`æˆå¤šä¸ªæ–‡ä»¶ï¼Œè¿™ç§ç¼–ç æ–¹å¼å°±æ˜¯`æ¨¡å—åŒ–`çš„ç¼–ç æ–¹å¼ã€‚
- æ‹†åˆ†å‡ºæ¥çš„`æ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—`ï¼Œæ¨¡å—ä¸­çš„æ•°æ®éƒ½æ˜¯`ç§æœ‰çš„`ï¼Œæ¨¡å—ä¹‹é—´äº’ç›¸`éš”ç¦»`ã€‚
- ä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›æ‰‹æ®µï¼ŒæŠŠæ¨¡å—å†…çš„æŒ‡å®šæ•°æ®â€œ`äº¤å‡ºå»`â€ï¼Œä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨ã€‚

### ä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—åŒ–ï¼Ÿ

éšç€åº”ç”¨çš„å¤æ‚åº¦è¶Šæ¥è¶Šé«˜ï¼Œä»£ç é‡å’Œæ–‡ä»¶æ•°é‡æ€¥å‰§å¢åŠ ï¼Œä¼šé€æ¸å¼•å‘ä»¥ä¸‹é—®é¢˜ï¼š

1. å…¨å±€æ±¡æŸ“é—®é¢˜
2. ä¾èµ–æ··ä¹±é—®é¢˜
3. æ•°æ®å®‰å…¨é—®é¢˜

## æœ‰å“ªäº›æ¨¡å—åŒ–è§„èŒƒï¼Ÿ

> ğŸ’¡ å†å²èƒŒæ™¯ï¼ˆäº†è§£å³å¯ï¼‰ï¼š2009 å¹´ï¼Œéšè€… Node.js çš„å‡ºç°ï¼ŒJavaScript åœ¨æœåŠ¡å™¨ç«¯çš„åº”ç”¨é€æ¸å¢å¤šï¼Œä¸ºäº†è®© Node.js çš„ä»£ç æ›´å¥½ç»´æŠ¤ï¼Œå°±å¿…é¡»è¦åˆ¶å®šä¸€ç§ Node.js ç¯å¢ƒä¸‹çš„æ¨¡å—åŒ–è§„èŒƒï¼Œæ¥è‡ª
> Mozilla çš„å·¥ç¨‹å¸ˆ Kevin Dangoor æå‡ºäº† CommonJS è§„èŒƒï¼ˆCommonJS åˆæœŸçš„åå­—å«
> ServerJSï¼‰ï¼Œéšå Nodejs ç¤¾åŒºé‡‡çº³äº†è¿™ä¸€è§„èŒƒã€‚

éšç€æ—¶é—´çš„æ¨ç§»ï¼Œé’ˆå¯¹ JavaScript çš„ä¸åŒè¿è¡Œç¯å¢ƒï¼Œç›¸ç»§å‡ºç°äº†å¤šç§æ¨¡å—åŒ–è§„èŒƒï¼š

1. `CommonJS` ------- æœåŠ¡ç«¯åº”ç”¨å¹¿æ³›
2. AMD
3. CMD
4. `ES6  æ¨¡å—åŒ–` --------- æµè§ˆå™¨ç«¯åº”ç”¨å¹¿æ³›

## å¯¼å…¥ä¸å¯¼å‡ºçš„æ¦‚å¿µ

æ¨¡å—åŒ–çš„æ ¸å¿ƒæ€æƒ³ï¼šæ¨¡å—ä¹‹é—´æ˜¯`éš”ç¦»`çš„ï¼Œé€šè¿‡`å¯¼å…¥`ä¸`å¯¼å‡º`è¿›è¡Œæ•°æ®å’ŒåŠŸèƒ½å…±äº«ã€‚

- **å¯¼å‡ºï¼ˆæš´éœ²ï¼‰**ï¼šæ¨¡å—å…¬å¼€å…¶å†…éƒ¨çš„ä¸€éƒ¨åˆ†ï¼ˆå¦‚å˜é‡ã€å‡½æ•°ç­‰ï¼‰ï¼Œä½¿å…¶å¯ä»¥è¢«å…¶ä»–æ¨¡å—ä½¿ç”¨ã€‚

- **å¯¼å…¥ï¼ˆå¼•å…¥ï¼‰**ï¼šæ¨¡å—å¼•å…¥å¹¶ä½¿ç”¨å…¶ä»–æ¨¡å—å¯¼å‡ºçš„å†…å®¹ï¼Œä»¥é‡ç”¨ä»£ç å’ŒåŠŸèƒ½ã€‚

  ![74937006512](.\assets\1749370065124.png)

## CommonJS è§„èŒƒ

### å®Œæ•´ç¤ºä¾‹

1. å¯¼å‡º**school.js**æ¨¡å—

```js
const name = 'å°šç¡…è°·'
const slogan = 'è®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯ï¼'

function getTel() {
  return '010-56253825'
}

function getCities() {
  return ['åŒ—äº¬', 'ä¸Šæµ·', 'æ·±åœ³', 'æˆéƒ½', 'æ­¦æ±‰', 'è¥¿å®‰']
}

// 1.é€šè¿‡ç»™exportså¯¹è±¡æ·»åŠ å±æ€§çš„æ–¹å¼, æ¥å¯¼å‡ºæ•°æ®(æ³¨æ„: æ­¤å¤„æ²¡æœ‰å¯¼å‡ºgetCities)
exports.name = name
exports.slogan = slogan
exports.getTel = getTel
// 2.æˆ–è€…ä½¿ç”¨module.exports
module.exports.name = name
module.exports.slogan = slogan
module.exports.getTel = getTel
// 3.æ¨èä½¿ç”¨ä»¥ä¸‹å†™æ³•
module.exports = {
  name,
  slogan,
  getTel,
}
```

3. åœ¨**index.js**å¯¼å…¥

```js
// 1.å¼•å…¥schoolæš´éœ²çš„æ‰€æœ‰å†…å®¹
const school = require('./school')
// 2.å¼•å…¥åŒæ—¶è§£æ„è¦ç”¨çš„æ•°æ®
const { name, slogan, getTel } = require('./school')
// 3.å¼•å…¥åŒæ—¶è§£æ„+é‡å‘½å
const { name: stuName, motto, getTel: stuTel } = require('./student')
```

### å¯¼å‡ºæ•°æ®

åœ¨ CommonJs æ ‡å‡†ä¸­,å¯¼å‡ºæ•°æ®æœ‰ä¸¤ç§æ–¹å¼

- ç¬¬ä¸€ç§: `module.exports = value`
- ç¬¬äºŒç§: `exports.name = value`

> âš ï¸ æ³¨æ„äº‹é¡¹ï¼š
>
> 1. æ¯ä¸ªæ¨¡å—å†…éƒ¨çš„`this`ã€`exports`ã€`module.exports` åˆå§‹æ—¶éƒ½æŒ‡å‘åŒä¸€ä¸ªç©ºå¯¹è±¡`{}`, è¯¥ç©ºå¯¹è±¡å°±æ˜¯å½“å‰æ¨¡å—å¯¼å‡ºçš„æ•°æ®ã€‚
> 2. æœ€ç»ˆå¯¼å‡ºçš„æ•°æ®ç”± `module.exports` å†³å®šã€‚
> 3. ä¸èƒ½ä½¿ç”¨ `exports = value`ï¼Œåªèƒ½ä½¿ç”¨ `module.exports = value`ã€‚export æ˜¯å¯¹ module.exports çš„åˆå§‹å¼•ç”¨,ä»…ä¸ºäº†æ–¹ä¾¿ç»™å¯¼å‡ºå¯¹è±¡æ·»åŠ å±æ€§,æ‰€ä»¥ä¸èƒ½ä½¿ç”¨ exports = value

### å¯¼å…¥æ•°æ®

åœ¨`CJS`æ¨¡å—åŒ–æ ‡å‡†ä¸­,ä½¿ç”¨å†…ç½®çš„`require`å‡½æ•°è¿›è¡Œå¯¼å…¥æ•°æ®

```js
// 1.ç›´æ¥å¼•å…¥æ¨¡å—
const school = require('./school')
// 2.å¼•å…¥åŒæ—¶è§£æ„è¦ç”¨çš„æ•°æ®
const { name, slogan, getTel } = require('./school')
// 3.å¼•å…¥åŒæ—¶è§£æ„+é‡å‘½å
const { name: stuName, motto, getTel: stuTel } = require('./student')
```

### æ‰©å±•ç†è§£

CJS æ¨¡å—æ‰§è¡Œæ—¶è¢«åŒ…è£¹åœ¨å¦‚ä¸‹`å†…ç½®å‡½æ•°`ä¸­, æ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼š

```js
function (exports, require, module, __filename, __dirname){
  // æ¨¡å—ä»£ç 
}
```

## ES6 æ¨¡å—åŒ–è§„èŒƒ

### å®Œæ•´ç¤ºä¾‹

1. å¯¼å‡º**school.js**æ¨¡å—

```js
// 1.åˆ†åˆ«å¯¼å‡º
export const name = { str: 'å°šç¡…è°·' }
export const slogan = 'è®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯ï¼'
export function getTel() {
  return '010-56253825'
}

const name = { str: 'å°šç¡…è°·' }
const slogan = 'è®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯ï¼'
function getTel() {
  return '010-56253825'
}

// 2.ç»Ÿä¸€å¯¼å‡º
export { name, slogan, getTel }
// 3.é»˜è®¤å¯¼å‡º
export default { name, slogan, getTel }
```

2. åœ¨**index.js**å¯¼å…¥

```js
// 1.ä¸‡èƒ½å¯¼å…¥: å°†æ¨¡å—ä¸­çš„æ‰€æœ‰å¯¼å‡ºå†…å®¹æ•´åˆåˆ°ä¸€ä¸ªå¯¹è±¡ä¸­
import * as school from './school.js'
// 2.å‘½åå¯¼å…¥(å¯¹åº”åˆ†åˆ«å¯¼å‡ºå’Œç»Ÿä¸€å¯¼å‡ºä½¿ç”¨),ä½¿ç”¨aså¯é‡å‘½å
import { name, slogan, getTel } from './school.js'
import { name as myName } from './school.js'
// 3.é»˜è®¤å¯¼å…¥(å¯¹åº”é»˜è®¤å¯¼å‡ºä½¿ç”¨):è¿™é‡Œstudentçš„åå­—å¯éšæ„ä¿®æ”¹
import student from './student.js'
// 4.æ··åˆå¯¼å…¥: é»˜è®¤å’Œå‘½åå¯¼å…¥æ··åˆ
import getTel, { name, slogan } from './school.js'
// 5.åŠ¨æ€å¯¼å…¥
const school = await import('./school.js')
// 6.importå¯ä»¥ä¸å¯¼å…¥ä»»ä½•æ•°æ®,åªå‚ä¸è¿è¡Œ(åªæ‰§è¡Œmock.jsä¸­çš„ä»£ç )
import './mock.js'
```

3. åœ¨**HTML**ä¸­

```html
<script type="module" src="./index.js"></script>
```

### Node ä¸­è¿è¡Œ ES6 æ¨¡å—

- æ–¹æ³• 1: æ”¹æ‰©å±•åä¸º `.mjs` , Node ä¼šè‡ªåŠ¨è¯†åˆ« ES6 æ¨¡å—

- æ–¹æ³• 2: åœ¨ `package.json` ä¸­è®¾ç½® `"type": "module"`

### å¯¼å‡ºæ•°æ®

1. åˆ†åˆ«å¯¼å‡º `export name`
2. ç»Ÿä¸€å¯¼å‡º `export {name, name2}`
3. é»˜è®¤å¯¼å‡ºï¼ˆdefaultï¼‰ `export default{name, name2}`, æ¯ä¸ªæ¨¡å—åªèƒ½æœ‰ 1 ä¸ªé»˜è®¤å¯¼å‡º

ç¤ºä¾‹ï¼š

```js
// 1.åˆ†åˆ«å¯¼å‡º
export const name = { str: 'å°šç¡…è°·' }
export const slogan = 'è®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯ï¼'
export function getTel() {
  return '010-56253825'
}

const name = { str: 'å°šç¡…è°·' }
const slogan = 'è®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯ï¼'
function getTel() {
  return '010-56253825'
}

// 2.ç»Ÿä¸€å¯¼å‡º
export { name, slogan, getTel }
// 3.é»˜è®¤å¯¼å‡º
export default { name, slogan, getTel }
```

> âš ï¸ æ³¨æ„:ä¸Šè¿°å¤šç§å¯¼å‡ºæ–¹å¼, å¯ä»¥åŒæ—¶ä½¿ç”¨

### å¯¼å…¥æ•°æ®

```js
// 1.ä¸‡èƒ½å¯¼å…¥: å°†æ¨¡å—ä¸­çš„æ‰€æœ‰å¯¼å‡ºå†…å®¹æ•´åˆåˆ°ä¸€ä¸ªå¯¹è±¡ä¸­
import * as school from './school.js'
// 2.å‘½åå¯¼å…¥(å¯¹åº”åˆ†åˆ«å¯¼å‡ºå’Œç»Ÿä¸€å¯¼å‡ºä½¿ç”¨),ä½¿ç”¨aså¯é‡å‘½å
import { name, slogan, getTel } from './school.js'
import { name as myName } from './school.js'
// 3.é»˜è®¤å¯¼å…¥(å¯¹åº”é»˜è®¤å¯¼å‡ºä½¿ç”¨):è¿™é‡Œstudentçš„åå­—å¯éšæ„ä¿®æ”¹
import student from './student.js'
// 4.æ··åˆå¯¼å…¥: é»˜è®¤å’Œå‘½åå¯¼å…¥æ··åˆ
import getTel, { name, slogan } from './school.js'
// 5.åŠ¨æ€å¯¼å…¥
const school = await import('./school.js')
// 6.importå¯ä»¥ä¸å¯¼å…¥ä»»ä½•æ•°æ®,åªå‚ä¸è¿è¡Œ(åªæ‰§è¡Œmock.jsä¸­çš„ä»£ç )
import './mock.js'
```

### æ•°æ®å¼•ç”¨é—®é¢˜

```js
// CommonJS
let sum = 1
function increment() {
  sum += 1
}
module.exports = { sum, increment }

// ES6
const sum = 1
function increment() {
  sum += 1
}
export { sum, increment }
```

> âš ï¸ ä½¿ç”¨åŸåˆ™ï¼š
>
> ES6 æ¨¡å—å¯¼å‡ºçš„å¸¸é‡ï¼ŒåŠ¡å¿…ç”¨ `const` å®šä¹‰
>
> å¦åˆ™å¼•å…¥æ¨¡å—åå¯ä»¥æ›´æ”¹æ¨¡å—çš„å˜é‡çš„å€¼,å› ä¸ºå…±ç”¨çš„ä¸€ä¸ªå†…å­˜ç©ºé—´,è€Œä¸æ˜¯åƒ CJS æ¨¡å—æ˜¯å¤åˆ¶çš„å€¼

## CJS å’Œ ES6 ä¸€è§ˆè¡¨

| å¯¼å‡º               | CommonJSï¼ˆCJSï¼‰                                        | ES6 æ¨¡å—                                                   |
| ------------------ | ------------------------------------------------------ | ---------------------------------------------------------- |
| **å•ä¸ªå˜é‡æˆ–å‡½æ•°** | `exports.name = value`æˆ– `module.exports.name = value` | ` export const name = value``export function getTel() {} ` |
| **å¤šä¸ªæˆå‘˜**       | é€ä¸ªæŒ‚åœ¨ `exports` ä¸Š(é‡å¤ å•ä¸ªå¯¼å‡º)                   | ç»Ÿä¸€å¯¼å‡ºï¼š`export { name, getTel }`                        |
| **æ•´ä¸ªå¯¹è±¡æˆ–å‡½æ•°** | `module.exports = value`ï¼ˆç›´æ¥æ›¿æ¢æ•´ä¸ªå¯¼å‡ºå¯¹è±¡ï¼‰       | é»˜è®¤å¯¼å‡ºï¼š`export default value`                           |

| å¯¼å…¥                        | CommonJSï¼ˆCJSï¼‰                                           | ES6 æ¨¡å—                                                   |
| --------------------------- | --------------------------------------------------------- | ---------------------------------------------------------- |
| **æ•´ä¸ªæ¨¡å—**                | `const mod = require('./mod')`                            | `import * as mod from './mod.js'`                          |
| **æŒ‡å®šæˆå‘˜ï¼ˆå‘½åå¯¼å…¥ï¼‰**    | ä½¿ç”¨å¯¹è±¡è§£æ„ï¼š`const { name, getTel } = require('./mod')` | `import { name, getTel } from './mod.js'`                  |
| **é»˜è®¤å¯¼å‡º**                | ä¸é€‚ç”¨ï¼ŒCJS æ²¡æœ‰é»˜è®¤å¯¼å‡ºæ¦‚å¿µ                              | `import value from './mod.js'`                             |
| **æ··åˆå¯¼å…¥ï¼ˆé»˜è®¤ + å‘½åï¼‰** | ä¸æ”¯æŒ                                                    | `import defaultExport, { named1, named2 } from './mod.js'` |
| **åŠ¨æ€å¯¼å…¥**                | å¯ä»¥ç”¨ `require()` å†™åœ¨å‡½æ•°ä½“ä¸­å®ç°åŠ¨æ€åŠ è½½               | `const mod = await import('./mod.js')` ï¼ˆè¿”å› Promiseï¼‰    |

## .js å’Œ.mjs .ts å’Œ.mts çš„åŒºåˆ«

| æ–‡ä»¶ç±»å‹ | æ¨¡å—ç³»ç»Ÿ                     | å¸¸ç”¨äº                     | æ˜¯å¦æ¨è            |
| -------- | ---------------------------- | -------------------------- | ------------------- |
| `.js`    | CommonJS or ESMï¼ˆçœ‹é…ç½®ï¼‰    | Node.jsã€å‰ç«¯è„šæœ¬          | âœ… å¸¸è§„ä½¿ç”¨         |
| `.mjs`   | å¼ºåˆ¶ ESM                     | Node.js ä¸­ç”¨ import/export | âœ… æ¨èï¼ˆESM æ¨¡å—ï¼‰ |
| `.ts`    | TypeScriptï¼ˆæ¨¡å—ç±»å‹çœ‹é…ç½®ï¼‰ | å¼€å‘æ—¶æœ€å¸¸ç”¨               | âœ… å¸¸ç”¨             |
| `.mts`   | TypeScript + ESM             | TypeScript é¡¹ç›®ä¸­ä½¿ç”¨ ESM  | âœ… æ¨èï¼ˆæ˜ç¡®æ„å›¾ï¼‰ |
